{
  "project": "Sanskrit Analyzer",
  "branchName": "ralph/sanskrit-mcp-server",
  "description": "MCP Server exposing Sanskrit Analyzer as Model Context Protocol service with 12 tools for analysis, dhatu lookup, and grammar operations, plus 4 resource categories for browsing reference data",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create MCP module structure",
      "description": "As a developer, I need the basic module structure for MCP server code so that I have a place to add tools and resources.",
      "acceptanceCriteria": [
        "Create sanskrit_analyzer/mcp/__init__.py",
        "Create sanskrit_analyzer/mcp/server.py (empty placeholder)",
        "Create sanskrit_analyzer/mcp/tools/__init__.py",
        "Create sanskrit_analyzer/mcp/tools/analysis.py (empty placeholder)",
        "Create sanskrit_analyzer/mcp/tools/dhatu.py (empty placeholder)",
        "Create sanskrit_analyzer/mcp/tools/grammar.py (empty placeholder)",
        "Create sanskrit_analyzer/mcp/resources/__init__.py",
        "Create sanskrit_analyzer/mcp/resources/dhatus.py (empty placeholder)",
        "Create sanskrit_analyzer/mcp/resources/grammar.py (empty placeholder)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Set up MCP server with HTTP/SSE transport",
      "description": "As a developer, I need the MCP server skeleton with HTTP/SSE transport so AI clients can connect remotely.",
      "acceptanceCriteria": [
        "Install mcp package and add to pyproject.toml dependencies",
        "Implement create_server() function in server.py that returns MCP Server instance",
        "Configure HTTP/SSE transport (not stdio)",
        "Server listens on configurable port (default 8001)",
        "Server can be started with python -m sanskrit_analyzer.mcp.server",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Add MCP server configuration",
      "description": "As a developer, I need server configuration options so deployment can be customized.",
      "acceptanceCriteria": [
        "Add MCPServerConfig dataclass with: host, port, log_level",
        "Support configuration via environment variables: MCP_HOST, MCP_PORT, MCP_LOG_LEVEL",
        "Support configuration via existing config.yaml under new mcp: section",
        "Environment variables override config file values",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Implement analyze_sentence tool",
      "description": "As an AI assistant, I want to analyze a Sanskrit sentence so I can provide full morphological breakdown to users.",
      "acceptanceCriteria": [
        "Register analyze_sentence tool with MCP server",
        "Accept parameters: text (str), mode (optional: educational|production|academic), verbosity (optional: str)",
        "Call existing Analyzer.analyze() method",
        "Return JSON with sandhi_groups, words, meanings, confidence",
        "Handle errors gracefully with descriptive messages",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Implement split_sandhi tool",
      "description": "As an AI assistant, I want to split sandhi in Sanskrit text so I can show word boundaries without full analysis.",
      "acceptanceCriteria": [
        "Register split_sandhi tool with MCP server",
        "Accept parameters: text (str), verbosity (optional: str)",
        "Return list of sandhi groups with split points",
        "Include sandhi rule applied (sutra reference) when available",
        "Lighter weight than full analyze (skip disambiguation if possible)",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement get_morphology tool",
      "description": "As an AI assistant, I want to get morphological tags for a word so I can explain its grammatical function.",
      "acceptanceCriteria": [
        "Register get_morphology tool with MCP server",
        "Accept parameters: word (str), context (optional: str), verbosity (optional: str)",
        "Return morphological tags: case, gender, number, person, tense, mood, voice",
        "Support both Devanagari and IAST input",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Implement transliterate tool",
      "description": "As an AI assistant, I want to convert text between scripts so I can present Sanskrit in the user's preferred format.",
      "acceptanceCriteria": [
        "Register transliterate tool with MCP server",
        "Accept parameters: text (str), from_script (str), to_script (str)",
        "Support scripts: devanagari, iast, slp1, itrans",
        "Use existing ScriptVariants utilities",
        "Return converted text string",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Implement lookup_dhatu tool",
      "description": "As an AI assistant, I want to look up a dhatu by its root so I can explain verb meanings and forms.",
      "acceptanceCriteria": [
        "Register lookup_dhatu tool with MCP server",
        "Accept parameters: dhatu (str), include_conjugations (optional: bool), verbosity (optional: str)",
        "Call existing DhatuDB.lookup_by_dhatu() method",
        "Return DhatuEntry JSON with meanings, gana, pada, examples",
        "Optionally include full conjugation tables",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Implement search_dhatu tool",
      "description": "As an AI assistant, I want to search dhatus by meaning or pattern so I can find roots when users ask 'what is the verb for X'.",
      "acceptanceCriteria": [
        "Register search_dhatu tool with MCP server",
        "Accept parameters: query (str), limit (optional: int, default 10), verbosity (optional: str)",
        "Call existing DhatuDB.search() method",
        "Return list of matching DhatuEntry JSON objects",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Implement conjugate_verb tool",
      "description": "As an AI assistant, I want to get conjugation forms for a dhatu so I can show users how verbs inflect.",
      "acceptanceCriteria": [
        "Register conjugate_verb tool with MCP server",
        "Accept parameters: dhatu (str), lakara (optional: str), purusha (optional: str), vacana (optional: str)",
        "Call existing DhatuDB.get_conjugation() method",
        "Return conjugation table or filtered forms based on parameters",
        "Include both Devanagari and IAST forms",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Implement list_gana tool",
      "description": "As an AI assistant, I want to list dhatus by verb class (gana) so I can explain gana patterns to users.",
      "acceptanceCriteria": [
        "Register list_gana tool with MCP server",
        "Accept parameters: gana (int, 1-10), limit (optional: int, default 20)",
        "Call existing DhatuDB.get_by_gana() method",
        "Return list of DhatuEntry JSON objects in that gana",
        "Validate gana is 1-10, return error otherwise",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Implement explain_parse tool",
      "description": "As an AI assistant, I want to compare multiple parse interpretations so I can explain ambiguity to users.",
      "acceptanceCriteria": [
        "Register explain_parse tool with MCP server",
        "Accept parameters: text (str), parse_indices (optional: list of int), verbosity (optional: str)",
        "Run analysis and return multiple parses from parse_forest",
        "If parse_indices provided, return only those parses",
        "Include confidence scores and engine votes for comparison",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Implement identify_compound tool",
      "description": "As an AI assistant, I want to identify compound types (samasa) so I can explain Sanskrit compound formation.",
      "acceptanceCriteria": [
        "Register identify_compound tool with MCP server",
        "Accept parameters: word (str), verbosity (optional: str)",
        "Detect compound type: tatpurusha, dvandva, bahuvrihi, avyayibhava, karmadharaya, dvigu",
        "Return compound type and component breakdown",
        "Use existing CompoundType enum",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Implement get_pratyaya tool",
      "description": "As an AI assistant, I want to identify suffixes applied to a word so I can explain word formation.",
      "acceptanceCriteria": [
        "Register get_pratyaya tool with MCP server",
        "Accept parameters: word (str), verbosity (optional: str)",
        "Analyze word and return list of pratyayas (suffixes) applied",
        "Include pratyaya type (krt, taddhita, tin, sup) and grammatical function",
        "Use existing Pratyaya model",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Implement resolve_ambiguity tool",
      "description": "As an AI assistant, I want to resolve ambiguous parses so I can give users the most likely interpretation.",
      "acceptanceCriteria": [
        "Register resolve_ambiguity tool with MCP server",
        "Accept parameters: text (str), context (optional: str)",
        "Run full disambiguation pipeline (rules then LLM if enabled)",
        "Return selected parse index, confidence, and reasoning",
        "Include all parse candidates for reference",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Add verbosity parameter handling",
      "description": "As a developer, I need consistent verbosity handling across all tools so AI can control response detail level.",
      "acceptanceCriteria": [
        "Create Verbosity enum: minimal, standard, detailed",
        "Create format_response(data, verbosity) helper function",
        "Minimal: essential data only (lemma, morphology codes)",
        "Standard: data with common fields expanded (default)",
        "Detailed: full data with explanatory text",
        "Apply to all tools that accept verbosity parameter",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Create dhatus resource provider",
      "description": "As an AI assistant, I want to browse the dhatu database as a resource so I can explore available roots.",
      "acceptanceCriteria": [
        "Register /dhatus resource with MCP server",
        "/dhatus returns overview: total count, gana distribution",
        "/dhatus/gana/{n} returns dhatus in gana n (1-10)",
        "/dhatus/{dhatu} returns full entry for specific dhatu",
        "/dhatus/{dhatu}/conjugations returns conjugation tables",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Create sandhi-rules resource provider",
      "description": "As an AI assistant, I want to browse sandhi rules as a resource so I can cite specific rules when explaining.",
      "acceptanceCriteria": [
        "Register /grammar/sandhi-rules resource with MCP server",
        "/grammar/sandhi-rules returns index of sandhi categories",
        "/grammar/sandhi-rules/vowel returns vowel sandhi rules (ac-sandhi)",
        "/grammar/sandhi-rules/consonant returns consonant sandhi rules (hal-sandhi)",
        "/grammar/sandhi-rules/visarga returns visarga sandhi rules",
        "Load rules from data/sandhi_rules.yaml",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Create pratyayas resource provider",
      "description": "As an AI assistant, I want to browse suffix reference as a resource so I can cite specific pratyayas.",
      "acceptanceCriteria": [
        "Register /grammar/pratyayas resource with MCP server",
        "/grammar/pratyayas returns index of suffix types",
        "/grammar/pratyayas/krt returns primary suffixes (krt pratyayas)",
        "/grammar/pratyayas/taddhita returns secondary suffixes",
        "/grammar/pratyayas/tin returns verb endings",
        "/grammar/pratyayas/sup returns noun endings",
        "Load data from data/pratyayas.yaml",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Create sutras resource provider",
      "description": "As an AI assistant, I want to browse Paninian sutras as a resource so I can cite grammatical rules authoritatively.",
      "acceptanceCriteria": [
        "Register /grammar/sutras resource with MCP server",
        "/grammar/sutras returns Astadhyayi overview (8 adhyayas, 4 padas each)",
        "/grammar/sutras/{adhyaya}/{pada} returns sutras in that section",
        "/grammar/sutras/search?q={term} searches sutras by topic",
        "Load data from data/sutras.yaml",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Create sandhi_rules.yaml placeholder",
      "description": "As a developer, I need a sandhi rules data file so the resource provider has data to serve.",
      "acceptanceCriteria": [
        "Create sanskrit_analyzer/data/sandhi_rules.yaml",
        "Include structure for vowel, consonant, visarga categories",
        "Add 5-10 example rules per category with: rule name, sutra reference, before, after, example",
        "Mark as placeholder with TODO for full population",
        "Typecheck passes (if any Python loading code)"
      ],
      "priority": 21,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Create pratyayas.yaml placeholder",
      "description": "As a developer, I need a pratyayas data file so the resource provider has data to serve.",
      "acceptanceCriteria": [
        "Create sanskrit_analyzer/data/pratyayas.yaml",
        "Include structure for krt, taddhita, tin, sup categories",
        "Add 5-10 example pratyayas per category with: name, meaning, grammatical function, example",
        "Mark as placeholder with TODO for full population",
        "Typecheck passes (if any Python loading code)"
      ],
      "priority": 22,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-023",
      "title": "Create sutras.yaml placeholder",
      "description": "As a developer, I need a sutras data file so the resource provider has data to serve.",
      "acceptanceCriteria": [
        "Create sanskrit_analyzer/data/sutras.yaml",
        "Include structure: adhyaya to pada to sutra list",
        "Add 3-5 example sutras per pada for adhyaya 1 (as sample)",
        "Each sutra has: number, text (Devanagari), transliteration, meaning",
        "Mark as placeholder with TODO for full population",
        "Typecheck passes (if any Python loading code)"
      ],
      "priority": 23,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-024",
      "title": "Add unit tests for analysis tools",
      "description": "As a developer, I need unit tests for analysis tools so I can verify they work correctly.",
      "acceptanceCriteria": [
        "Create tests/mcp/test_analysis_tools.py",
        "Test analyze_sentence with valid Sanskrit input",
        "Test split_sandhi returns correct sandhi groups",
        "Test get_morphology returns valid morphological tags",
        "Test transliterate correctly converts between scripts",
        "Test error handling for invalid inputs",
        "All tests pass"
      ],
      "priority": 24,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-025",
      "title": "Add unit tests for dhatu tools",
      "description": "As a developer, I need unit tests for dhatu tools so I can verify they work correctly.",
      "acceptanceCriteria": [
        "Create tests/mcp/test_dhatu_tools.py",
        "Test lookup_dhatu with known dhatu (e.g., gam)",
        "Test search_dhatu returns relevant results for meaning search",
        "Test conjugate_verb returns correct conjugation forms",
        "Test list_gana returns dhatus for valid gana (1-10)",
        "Test error handling for unknown dhatu, invalid gana",
        "All tests pass"
      ],
      "priority": 25,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "title": "Add unit tests for grammar tools",
      "description": "As a developer, I need unit tests for grammar tools so I can verify they work correctly.",
      "acceptanceCriteria": [
        "Create tests/mcp/test_grammar_tools.py",
        "Test explain_parse returns multiple parse candidates",
        "Test identify_compound detects known compound types",
        "Test get_pratyaya identifies suffixes",
        "Test resolve_ambiguity returns selected parse with reasoning",
        "Test error handling for invalid inputs",
        "All tests pass"
      ],
      "priority": 26,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "title": "Add unit tests for resource providers",
      "description": "As a developer, I need unit tests for resource providers so I can verify they serve correct data.",
      "acceptanceCriteria": [
        "Create tests/mcp/test_resources.py",
        "Test /dhatus resource returns overview",
        "Test /dhatus/gana/1 returns gana 1 dhatus",
        "Test /grammar/sandhi-rules returns rule index",
        "Test /grammar/pratyayas returns suffix index",
        "Test /grammar/sutras returns sutra overview",
        "All tests pass"
      ],
      "priority": 27,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-028",
      "title": "Add MCP client integration test",
      "description": "As a developer, I need an integration test that connects as an MCP client to verify end-to-end functionality.",
      "acceptanceCriteria": [
        "Create tests/mcp/test_integration.py",
        "Start MCP server in test fixture",
        "Connect using MCP client SDK",
        "Call analyze_sentence tool and verify response structure",
        "Read /dhatus resource and verify data",
        "Test passes with real HTTP/SSE connection",
        "All tests pass"
      ],
      "priority": 28,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-029",
      "title": "Add MCP server entry point",
      "description": "As a developer, I need a proper entry point so the MCP server can be easily started.",
      "acceptanceCriteria": [
        "Add [project.scripts] entry in pyproject.toml: sanskrit-mcp = sanskrit_analyzer.mcp.server:main",
        "Implement main() function that starts the server",
        "Support --host, --port, --log-level CLI arguments",
        "Server can be started with sanskrit-mcp command after install",
        "Typecheck passes"
      ],
      "priority": 29,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030",
      "title": "Create homelab deployment configuration",
      "description": "As a developer, I need deployment configuration so the MCP server can run on homelab.",
      "acceptanceCriteria": [
        "Create docker/mcp/Dockerfile for MCP server",
        "Add sanskrit-mcp service to docker/docker-compose.yml",
        "Configure port 8001 (separate from FastAPI on 8000)",
        "Add health check configuration",
        "Document deployment in README or separate doc",
        "Docker build succeeds"
      ],
      "priority": 30,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-031",
      "title": "Add health check endpoint",
      "description": "As an operator, I need a health check so monitoring can verify the MCP server is running.",
      "acceptanceCriteria": [
        "Add /health endpoint to MCP server",
        "Returns JSON with: status, version, uptime, component health",
        "Check analyzer availability",
        "Check DhatuDB connectivity",
        "Return appropriate HTTP status codes (200 OK, 503 unhealthy)",
        "Typecheck passes"
      ],
      "priority": 31,
      "passes": false,
      "notes": ""
    }
  ]
}
